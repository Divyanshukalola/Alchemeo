
{% extends 'layouts/base.html' %}
{% load mathfilters %}
{% load humanize %}
{% block title %} Invoices {% endblock title %}

{% block content %}




<main class="main-content mt-1 border-radius-lg">
  <!-- Navbar -->
    <!-- Navbar -->
<nav class="navbar navbar-main navbar-expand-lg px-0 mx-4 shadow-none border-radius-xl noprint" id="navbarBlur" navbar-scroll="true">
  <div class="container-fluid py-1 px-3">
    <nav aria-label="breadcrumb">
      
      <h6 class="font-weight-bolder mb-0">Invoices</h6>
    </nav>
    <div class="collapse navbar-collapse mt-sm-0 mt-2 me-md-0 me-sm-4" id="navbar">
      <div class="ms-md-auto pe-md-3 d-flex align-items-center">
        
      </div>
      <ul class="navbar-nav  justify-content-end">
        <li class="nav-item d-flex align-items-center">
          <a href="/Profile/" class="nav-link text-body font-weight-bold px-0">
            <i class="fa fa-user me-sm-1"></i>
            <span class="d-sm-inline d-none">{{request.user.username}}</span>
          </a>
        </li>
        <li class="nav-item d-xl-none ps-3 d-flex align-items-center">
          <a href="javascript:;" class="nav-link text-body p-0" id="iconNavbarSidenav">
            <div class="sidenav-toggler-inner">
              <i class="sidenav-toggler-line"></i>
              <i class="sidenav-toggler-line"></i>
              <i class="sidenav-toggler-line"></i>
            </div>
          </a>
        </li>
        <li class="nav-item px-3 d-flex align-items-center">
          <!-- <a href="javascript:;" class="nav-link text-body p-0">
            <i class="fa fa-cog fixed-plugin-button-nav cursor-pointer"></i>
          </a> -->
        </li>
        <li class="nav-item dropdown pe-2 d-flex align-items-center">
          <a href="javascript:;" class="nav-link text-body p-0" id="dropdownMenuButton" data-bs-toggle="dropdown" aria-expanded="false">
            <i class="fa fa-bell cursor-pointer"></i>
            <span class="badge badge-md badge-circle badge-floating badge-danger border-white mx-0 px-0" style="color: rgb(116, 116, 116);">{{request.user.inventory.accessrequest_set.all.count}}</span>
          </a>
          <ul class="dropdown-menu  dropdown-menu-end  px-2 py-3 me-sm-n4" aria-labelledby="dropdownMenuButton">
            {% if request.user.inventory.accessrequest_set.all%}
            {% for r in request.user.inventory.accessrequest_set.all%}
            <li class="mb-2">
              <a class="dropdown-item border-radius-md" >
                <div class="d-flex py-1" data-bs-toggle="modal" data-bs-target="#v{{r.Request_ID}}">
                 
                  <div class="d-flex flex-column justify-content-center">
                    <h6 class="text-sm font-weight-normal mb-1">
                      <span class="font-weight-bold">Request</span> from {{r.Request_from}}
                    </h6>
                    <p class="text-xs text-secondary mb-0">
                      <i class="fa fa-clock me-1"></i>
                      {{r.Request_date}}
                    </p>
                  </div>
                </div>
              </a>
            </li>



         
            {% endfor %}
            {% else %}
            <li class="mb-2">
              <a class="dropdown-item border-radius-md">
                No Requests Pending ...
              </a>
            </li>
            {% endif %}
           
          </ul>
        </li>
          </ul>
    </div>
  </div>
</nav>


{% for r in request.user.inventory.accessrequest_set.all%}
<!-- Modal -->
<div class="modal fade" id="v{{r.Request_ID}}" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
 <div class="modal-dialog modal-dialog-centered" role="document">
   <div class="modal-content">
     <div class="modal-header">
       <h5 class="modal-title" id="exampleModalLabel">Inventory Access Request</h5>
       <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close">
         <span aria-hidden="true">&times;</span>
       </button>
     </div>
     <div class="modal-body">
       <div class="d-flex flex-column justify-content-center">
         <h6 class="text-sm font-weight-normal mb-1">
           <span class="font-weight-bold">Request</span> from {{r.Request_from}}
         </h6>
         <p class="text-xs text-secondary mb-0">
           <i class="fa fa-clock me-1"></i>
           {{r.Request_date}}
         </p>
       </div>
     </div>
     <div class="modal-footer">
       
       <form action="/AccessRequest1/" method="post">
         {% csrf_token %}
         <input type="text" name="actionid" id="actionid" value="{{r.Request_ID}}" hidden>
         <input type="text" name="action" id="action" value="accept" hidden>
         <input type="text" name="page" value="Invoice_dashboard" hidden>
       <button type="submit" class="btn bg-gradient-success">Accept Request</button>
       </form>

     <form action="/AccessRequest1/" method="post">
       {% csrf_token %}
       <input type="text" name="actionid" id="actionid" value="{{r.Request_ID}}" hidden>
       <input type="text" name="action" id="action" value="delete" hidden>
       <input type="text" name="page" value="Invoice_dashboard" hidden>
     <button type="submit" class="btn bg-gradient-danger" >Delete</button>
     </form>

     <button type="button" class="btn bg-gradient-secondary" data-bs-dismiss="modal">Close</button>
     </div>
   </div>
 </div>
</div>

{% endfor %}
  <!-- End Navbar -->
  

  <div class="container-fluid py-4">
    <form action="/save_invoice/" method="post">
      {% csrf_token %}
  <div class="row px-2">
    <div class="card">
      <div class="card-header pb-0">
        <div class="row">
          <div class="col-6">
            <h6 id="hed1">Create Invoice</h6>
            <h6 id="hed2" hidden>Create Invoice</h6>
          </div>
          <div class="col-6 text-right">
            <button type="submit" class="btn bg-gradient-primary mx-4" style="text-align: center;" value="Submit" id="savebutton"> Save Invoice</button>
            <button type="submit" class="btn bg-gradient-primary mx-4" style="text-align: center;" value="Submit" id="savebutton2" hidden> Save Changes</button>
  
          </div>
        </div>
        

       

      </div>
      <div class="card-body p-3">
        <div id="INID" hidden>
          <div class="row">
            <div class="col">
              <h6 class="mb-0 text-sm">Invoice ID: <span id=ID></span></h6>
              <input type="text" name="invoiceID" id="invoiceID" hidden>
            </div>

            <div class="col">
              <h6 class="mb-0 text-sm">Date: <span id=date></span></h6>
            </div>
        </div>
        <hr class="mt-3 mb-3">
        </div>

        <div class="row">
          <div class="col-4">
            <h6 class="mb-0 text-sm mb-2">Name: </h6>
            <input  type='text' id="InvoiceName" name="InvoiceName" style="text-transform: capitalize;" class='form-control' placeholder='Invoice Name' autocomplete="off" required>
          </div>
          <div class="col-4">
            <h6 class="h6 mb-0 text-sm mb-2">Member ID: </h6>
            <input type='text' id="MemberID1" name="MemberID1" class='form-control ' placeholder='Member ID' style="text-transform: uppercase;" autocomplete="off">
          </div>
          <div class="col-4">
            <h6 class="h6 mb-0 text-sm mb-2">Mobil No.: </h6>
            <input type='text' class='form-control ' id="cinfo" name="cinfo" placeholder='Contact Information' autocomplete="off">
          </div>
        </div>

<br>
        <div class="table-responsive">
          <table class="table align-items-center mb-0 " id="myTable">
            <thead>
              <tr>
                <th class="text-uppercase text-secondary text-xxs font-weight-bolder opacity-7 border">#</th>
                <th class="text-uppercase text-secondary text-xxs font-weight-bolder opacity-7 ps-3 border">ItemID</th>
                <th class="text-left text-uppercase text-secondary text-xxs ps-3 font-weight-bolder opacity-7 border">Quantity</th>
                <th class="text-left text-uppercase text-secondary text-xxs ps-3 font-weight-bolder opacity-7 border">Price</th>
                <th class="text-left text-uppercase text-secondary text-xxs ps-3 font-weight-bolder opacity-7 border">Amount</th>
            
              </tr>
            </thead>
            <tbody id="tbody">
              <tr>
                <td>
                  <div class="d-flex px-3">
                    <div class="d-flex flex-column justify-content-center">
                      <p class="text-xs text-secondary mb-0">1</p>
                    </div>
                  </div>
                </td>
                <td>
                  <span class="mb-0 text-sm">
                    <input type='text' id="ItemName0" name="ItemName0"  class='form-control ItemName1' placeholder='Item ID' autocomplete="off" required>
                    
                  </span>
                </td>
                <td class="align-middle text-left text-sm">
                  <input type='number' class='form-control Quantity1 mt-3' id="Quantity0" name="Quantity0" min="1" value="0" placeholder='Quantity' required>
                  <div class="row px-2">
                    <div class="col">
                      <h6 style="color: rgb(182, 182, 182);" class="mb-0 text-xs">Available Stock: <span id="stock0">0</span></h6>  
                      <input type='number' class='form-control availstock mt-3' id="stock0" name="stock0" placeholder='Stock' min="0" value="0" hidden>
                    </div>
                  </div>
                </td>
                <td class="align-middle text-left">
                  <input type='number' class='form-control priceperQuantityg1' id="priceperQuantityg0" min="0" name="priceperQuantityg0" placeholder='Price with GST' step="0.01" hidden>
                  <input type='number' class='form-control priceperQuantity1 mt-3' id="priceperQuantity0" min="0" name="priceperQuantity0" placeholder='Price' step="0.01">
                  <div class="row px-2">
                  
                    {% for t in request.user.salesuser.SalesUser_Inventory.definedtags_set.all %}
                    <div class="col">
                      <h6 style="color: #28a745;" class="mb-0 text-xs">{{t.Tag_Title}}: <span id="tagval{{t.Tag_Title}}0">0</span></h6>  
                      <input type='number' class='form-control tagvalinp{{t.Tag_Title}} mt-3' min='0' id="tagvalinp{{t.Tag_Title}}0" name="tagvalinp{{t.Tag_Title}}0" placeholder='Price' step="0.01" value="0" hidden>
                    </div>
                    {% endfor %}
                  </div>
                </td>
                <td class="align-middle">
                  <input type='number' class='form-control price1g' id='priceg0' name="priceg0" min="0" placeholder='Total Price With GST' step="0.01" hidden>
                  <input type='number' class='form-control price1' id='price0' name="price0" min="0" placeholder='Total Price' step="0.01">
                  {% for t in request.user.salesuser.SalesUser_Inventory.definedtags_set.all %}
                  <div class="col">
                    <input type='number' class='form-control tagvalinptot{{t.Tag_Title}} mt-3' id="tagvalinptot{{t.Tag_Title}}0" name="tagvalinptot{{t.Tag_Title}}0" placeholder='Price' step="0.01" value="0" hidden>
                  </div>
                  {% endfor %}
                </td>
              </tr>
      
             
            </tbody>
          </table>
          <br>
          <div class="row container-fluid text-center">
                
            <div class="col-12">
              <button type="button" onclick="myCreateFunction()" class="btn btn-primary btn-sm ml-2" style="text-align: center;"> Add new row</button>
              <button type="button" onclick="myDeleteFunction()" class="btn btn-secondary btn-sm" style="text-align: center;"> Delete row</button>
              
            </div>
          
          </div>

          <hr>
              <div class="row mx-2">
                <div class="col-6">
                  <h6 class="text-sm">Invoice Comments:</h6>
                  <textarea class='form-control' id="comments" name="comments" rows="4" placeholder="Add something that you want to remember .."></textarea>  
                </div>
                <div class="col-6">
                  <h6 class="text-sm">Uncheck if the invoice is pending:</h6>
                  <div class="custom-control custom-checkbox mb-3">
                    <input class="custom-control-input" id="customCheck2" name="customCheck2" type="checkbox" checked>
                    <label class="custom-control-label" for="customCheck2">Confirmed</label>
                  </div>

                  
                </div>
                
             </div>

             <div class="row mx-2">
              <div class="col-6">
                <hr class="mb-3">
                <small>
                <h6 class="text-sm" style="font-weight:normal">Sub Total: Rs. 
                  <span id='subtotal' style="font-weight: bold;">0</span> 
                  <input type="number" name="SubTotal" id="SubTotal" hidden> 
                </h6>
                <h6 class="text-sm" style="font-weight:normal" >GST Number: 
                  <b id="gstnumber">{{SaleUser.Invoice_GST_no}}</b> 
                  <input type="text" id="gstnumber" name="gstnumber" hidden>
                </h6>
                <h6 class="text-sm" style="font-weight:normal">Total (Including GST 0%): Rs. 
                  <span id='total' style="font-weight: bold;">0</span> 
                  <input type="number" name="FinalTotal" id="FinalTotal" hidden>
                </h6>
                <input type="number" id="numberofitems" name="numberofitems" value="1" hidden>
              </small>
              </div>

              <div class="col-4">
                <hr class="mb-3">
                <small>
                  {% for t in request.user.salesuser.SalesUser_Inventory.definedtags_set.all %}
                  <h6 class="text-sm" style="font-weight:normal">{{t.Tag_Title}}: <span id='tagsp{{t.Tag_Title}}' style="font-weight: bold;">0</span> <input type="number" name="tag{{t.Tag_Title}}" id="tag{{t.Tag_Title}}" hidden step="0.001" value="0"> <b></b></h6>
                  {% endfor %}
          
              </small>
              </div>

            </div>

           

           



             <br>



        </div>

       
      
      </div>
    </div>
  </div>
  </form>
  <br>
      <div class="row noprint">
        <div class="col-lg-6">
          <div class="row">
            <div class="col-lg-8">
              <div class="card bg-transparent shadow-xl">
                <div class="overflow-hidden position-absolute border-radius-xl" style="background-image: url('/static/assets/img/curved-images/curved14.jpg');" >
                  <span class="mask bg-gradient-dark"></span>
                  <div class="card-body position-relative z-index-1 p-3">
                    <h6 class="text-white opacity-8 mt-4">Sales ID: {{request.user.salesuser.SalesUser_ID}}</h6>
                    <h6 class="text-white opacity-8 mb-4">Inventory ID: {{request.user.salesuser.SalesUser_Inventory.Inventory_ID}}</h6>
                    <div class="d-flex">
                      <div class="d-flex">
                        <div class="me-4">
                          <h6 class="text-white mb-0 opacity-8 mb-0">Address: </h6>
                          <h6 class="text-white mb-0 opacity-8">{{request.user.salesuser.SalesUser_Address}}</h6>
                        </div>
                     
                      </div>
                     
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="col-lg-4">
              <div class="card h-200">
                <div class="card-header mx-4 p-3 text-center">
                  <div class="icon icon-shape icon-lg bg-gradient-primary shadow text-center border-radius-lg">
                    <i class="ni ni-single-02"></i>
                  </div>
                </div>
                <div class="card-body pt-0 p-3 text-center">
                  <h6 class="text-center mb-0">Total Invoice</h6>
                  <span class="text-xs">Total Invoice Generated</span>
                  <hr class="horizontal dark my-3">
                  <h5 class="mb-0">{{request.user.salesuser.invoice_set.all.count}}</h5>
                </div>
              </div>
     
            </div>
          </div>
          <br>

          <div class="row px-2">
            <div class="card">
              <div class="card-header pb-0">
                <h6>Invoices overview</h6>
              </div>
              <div class="card-body p-3">
                <div class="bg-gradient-dark border-radius-lg py-3 pe-1 mb-3">
                  <div class="chart">
                    <canvas id="chart-bars" class="chart-canvas" height="200"></canvas>
                  </div>
                </div>
               
               
              </div>
            </div>
          </div>
        </div>
       
        <!-- revisit this section -->
        <div class="col-lg-6 overflow-auto position-relative" >
        
          <div class="card ">
            <div class="card-header pb-0">
              
              <div class="row">
                <div class="col-md-5 d-flex align-items-center">
                  <h6 class="mb-0">Invoices</h6>
                </div>

                <div class="col-md-7 ">
                  <div class="form-group">
                    <div class="input-group mb-2">
                      <span class="input-group-text"><i class="ni ni-zoom-split-in"></i></span>
                      <input class="form-control" placeholder="Search Invoice by ID or name" id="myInput" onkeyup="myFunction1()" type="text">
                    </div>
                  </div>
                </div>
              
              </div>
            </div>
            <style>
              .invoice:hover{
                background-color: #cfe0f027;
              }
            </style>
            <div class="card-body p-3 pb-0" >
              <ul class="list-group overflow-auto" style="height: 490px;" id="myTablefilter">
                {% if Invoices != 0%}
                {% for i in Invoices %}
               
                {% if forloop.counter <= 10 %}

                
               

                <div class='invoice ml-5 border-radius-lg'>
                  <div class="row itemlist">
                    <div class="col-9">
                      <li class="list-group-item border-0 d-flex justify-content-between ps-0 bg-transparent mx-2 mb-2 border-radius-lg" data-bs-toggle="modal" data-bs-target="#v{{i.Invoice_ID}}" style="cursor: pointer;" >
                        <div class="d-flex flex-column pl-5">
                          <h6 class="mb-1 text-dark font-weight-bold text-sm" id="name">{{i.Invoice_Title}}</h6>
                          <p id="ID" hidden>{{i.Invoice_ID}}</p>
                          <span class="text-xs">{{i.Invoice_Date|naturalday}} - ID: #{{i.Invoice_ID}}</span>
                        </div>
                       
                        <div class="d-flex align-items-center text-sm mr-0">
                          Rs {{i.Invoice_Total_Amount}}
                          {% if i.Invoice_status%}
                          <i class="ni ni-check-bold text-lg me-1 mx-3"></i>
                          {% else %}
                          <i class="ni ni-time-alarm text-lg me-1 mx-3"></i>
                          {% endif %}
                        </div>
                      </li>
                    </div>

                    <div class="col-1 mt-3 mr-0 " id="Print{{i.Invoice_ID}}" rel="tooltip" data-original-title="" title="" style="cursor: -webkit-grab; cursor: grab;">
                      <i style="color: cornflowerblue;" class="fas fa-print"></i>
                    </div>
                    <div class="col-1 mt-3 mr-1 ml-0 text-center  container-fluid d-flex" rel="tooltip" data-original-title=""  title="" style="cursor: -webkit-grab; cursor: grab;">
                    <form action="/view_invoice/" method="POST" target="_blank">
                      {% csrf_token %}
                      <input type="text" name="invid" value="{{i.Invoice_ID}}" hidden>
                    
                      <button style="background: transparent; border: transparent;" class=" px-1" type='submit'><i style="color: #28a745;" class="fas fa-eye"></i></a>
                  
                    </form>
                    </div>
                    <div class="col-1 mt-3" rel="tooltip" data-original-title=""  title="" style="cursor: -webkit-grab; cursor: grab;">
                      <a data-bs-toggle="modal" data-bs-target="#d{{i.Invoice_ID}}"><i style="color: #dc3545;" class="fas fa-trash"></i></a>
                    </div>
                  </div>

                </div>
               
                {% else %}
                {% endif %}
           
              
                {% endfor %}
                {% else %}
                {% endif %}
               
              </ul>
            </div>
          </div>
        </div>


<!-- edit/view invoice  -->

      {% if Invoices != 0 %}
      {% for i in Invoices %}

      <div class="modal fade" id="v{{i.Invoice_ID}}"  tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true" >
        <div class="modal-dialog modal-xl" role="document" >
          <div class="modal-content border" id="printThis{{i.Invoice_ID}}" style="height: auto;overflow: scroll;" >
            
            <form action="/edit_invoice/" method="post">
              {% csrf_token %}

            <div class="modal-body">

              

              <input type="text" name="invoiceid" id="invoiceid" value="{{i.Invoice_ID}}" hidden>
              <!-- <h4 > Title : {{i.Invoice_Title}} {% if i.Invoice_member_ID %} - {{i.Invoice_member_ID}} {% else %}{% endif%}</h4> -->
                  <!-- <hr class="mt-2 mb-3"> -->
                  <div class="row mt-0">
                    <div class="col-11 printimg">
                      <img src="{{i.Invoice_User.Sales_User_image.url}}" alt="" width="100px" class=" mb-0">
                    </div>
                    <div class="col-1 text-right noprint">
                      <button type="button" class="btn-close " data-bs-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true" style="color: black;">&times;</span>
                      </button>
                    </div>
                  </div>
                 
                  <hr class="mt-2 mb-3">
              <div class="row">
                <div class="col-8">
                  

                  <h6 class="text-sm">Name: {{i.Invoice_Title}}</h6>
                  <h6 class="text-sm">Invoice ID: {{i.Invoice_ID}}</h6>
                  {% if i.Invoice_member_ID != '' %}
                  <h6 class="text-sm">Member ID: {{i.Invoice_member_ID}}</h6>
                    {% else %}
                    <h6 class="text-sm">Member ID: N/A</h6>
                    {% endif %}
    
                  
                  <!-- <h6>Invoice Created by: <span style="text-transform: capitalize;">{{i.Invoice_User.Sales_User.username}}</span> - {{i.Invoice_User.SalesUser_ID}}</h6> -->
                  {% if i.Invoice_ContactInfo != '' %}
                  <h6 class="text-sm">Contact Information :  {{i.Invoice_ContactInfo}}</h6>
                    {% else %}
                    <h6 class="text-sm">Contact Information :  N/A</h6>
                    {% endif %}
                </div>

                <style>
                  #address p{
                   font-size: 1em;
                   font-family: inherit;
                   font-weight: 600;
                   line-height: 1.5;
                   color: #32325d;
                  }
                </style>

                <div class="col-4 h6" id="address">
                  <p class="text-sm">{{i.Invoice_User.SalesUser_Address|linebreaks}}</p>
                  
                </div>
              </div>
             
              
              <hr class="mt-0 mb-2">
              <h6 class="text-sm">Time Stamp :  {{i.Invoice_Date}}</h6>
              <div class="table-responsive">
              <table class="table align-items-center table-flush" id="tedit{{i.Invoice_ID}}">
                <thead>
                    <tr>
                        <th class="text-center text-uppercase text-secondary text-xxs font-weight-bolder opacity-7 col-0 border" style="background-color: #f6f9fc;">#</th>
                        <th class="col-3 border text-uppercase text-secondary text-xxs font-weight-bolder opacity-7" style="background-color: #f6f9fc;">ID - Name</th>
                        <th class="text-right col-3 border text-uppercase text-secondary text-xxs font-weight-bolder opacity-7" style="background-color: #f6f9fc;">Quantity</th>
                        <th class="text-right col-3 border text-uppercase text-secondary text-xxs font-weight-bolder opacity-7" style="background-color: #f6f9fc;">Price (MRP)</th>
                        <th class="text-right col-3 border Unhideprint text-uppercase text-secondary text-xxs font-weight-bolder opacity-7" style="background-color: #f6f9fc;" hidden>Tax Rate:</th>
                        <th class="text-right col-3 mr-3 border text-uppercase text-secondary text-xxs font-weight-bolder opacity-7" style="background-color: #f6f9fc;">Amount</th>
                        
                        
                    </tr>
                </thead>
                <tbody id="tablebody{{i.Invoice_ID}}">
                  {% for x in i.invoiceitem_set.all %}
                    <tr>
                        <td class="text-center h6 mb-0 text-xs">{{forloop.counter}}</td>
                        <td >
                          <input type="text" class='form-control inp{{i.Invoice_ID}} ItemName1' name="ItemName1{{i.Invoice_ID}}{{x.Item_ID}}" id="ItemName1{{i.Invoice_ID}}{{x.Item_ID}}" value="{{x.Item_ID}} : {{x.Item_name}}" hidden><span id="field" class="h6 mb-0 text-xs">{{x.Item_ID}} : {{x.Item_name}}</span>
                          <div class="row px-2 h6 mb-0 text-xs">
                            {% for p in list_product %}
                              {% if p.Product_ID == x.Item_ID %}
                                {% for tg in p.producttags_set.all %}
                                <span>
                                <div class="col-4">
                                  <h6 style="color: #7a857d;" class=" mb-0 text-xs">{{tg.Defined_Tags.Tag_Title}}: <b id="tagval{{t.Tag_Title}}0">{{tg.Tag_value}}</b></h6>  
        
                                </div>
                              </span>
                                {% endfor %}
                              {% else %}
                              {% endif %}
                            {% endfor %}
                          </div>
                        </td>

                        <td class="text-right "><input type="text" class='form-control inp{{i.Invoice_ID}} Quantity1' name="Quantity1{{i.Invoice_ID}}{{x.Item_ID}}" id="Quantity1{{i.Invoice_ID}}{{x.Item_ID}}" value="{{x.Item_Quantity}}" hidden><span id="field" class="h6 mb-0 text-xs">{{x.Item_Quantity}}</span></td>
                        <td class="text-right "><input type='number' class='form-control priceperQuantityg1{{i.Invoice_ID}}' id="priceperQuantityg1{{i.Invoice_ID}}{{x.Item_ID}}" name="priceperQuantityg1{{i.Invoice_ID}}{{x.Item_ID}}" placeholder='Price with GST' hidden><input type="text" class='form-control inp{{i.Invoice_ID}} priceperQuantity1' name="priceperQuantity1{{i.Invoice_ID}}{{x.Item_ID}}" id="priceperQuantity1{{i.Invoice_ID}}{{x.Item_ID}}" value="{{x.Item_price}}" hidden><span id="field" class="h6 mb-0 text-xs">{{x.Item_price}}</span>
                          <div class="row px-2">
                            {% for p in list_product %}
                              {% if p.Product_ID == x.Item_ID %}
                                  {% for tg in p.producttags_set.all %}
                                  <div class="col">
                                    
                                    <h6 style="color: #28a745;" class="mb-0 text-xs">{{tg.Defined_Tags.Tag_Title}}: <b id="tagtot{{tg.Tag_value}}{{i.Invoice_ID}}{{forloop.counter}}{{p.Product_ID}}"></b></h6>  
                                  
                                    <input type='number' class='form-control tagvalinp{{t.Defined_Tags.Tag_Title}} mt-3' id="tagvalinp{{t.Defined_Tags.Tag_Title}}" name="tagvalinp{{t.Defined_Tags.Tag_Title}}" placeholder='Price' step="0.01" value="0" hidden>
                                  </div>

                                  <script>
                                    document.getElementById('tagtot{{tg.Tag_value}}{{i.Invoice_ID}}{{forloop.counter}}{{p.Product_ID}}').innerText = (parseFloat('{{tg.Tag_value}}')*parseFloat('{{x.Item_Quantity}}')).toFixed(2);
                                  </script>
                                  {% endfor %}
                              {% else %}
                              {% endif %}
                            {% endfor %}
                          </div>
                        </td>
                        
                        <td class="text-right Unhideprint" hidden><span id="field" class="Unhideprint h6 mb-0 text-xs">{{x.Item_gst}}</span></td>
                        <td class="text-right mr-3">
                        {% if x.Member %}
                          <input type='number' class='form-control price1g' id='priceg{{i.Invoice_ID}}' name="priceg{{i.Invoice_ID}}" placeholder='Total Price With GST' hidden><input type="text" class='form-control inp{{i.Invoice_ID}} price2' name="price1{{i.Invoice_ID}}" id="price1{{i.Invoice_ID}}" value="{%widthratio x.Item_price 1 x.Item_Quantity%}" hidden><span id="field1" class="h6 mb-0 text-xs"> Rs {%widthratio x.Item_price 1 x.Item_Quantity%}</span>
                        {% else %}
                        <input type='number' class='form-control price1g' id='priceg{{i.Invoice_ID}}' name="priceg{{i.Invoice_ID}}" placeholder='Total Price With GST' hidden><input type="text" class='form-control inp{{i.Invoice_ID}} price2' name="price1{{i.Invoice_ID}}" id="price1{{i.Invoice_ID}}" value="{%widthratio x.Item_price 1 x.Item_Quantity%}" hidden><span id="field1" class="h6 mb-0 text-xs">Rs {%widthratio x.Item_price 1 x.Item_Quantity%}</span>
                        {% endif %}

                        
                        </td>
                       
                    </tr>
                  
                  {% endfor %}

                  
                   
                </tbody>
                
            </table>
              </div>


            
            <hr class="mt-2 mb-2">

            <!-- class = 'noprint' -->

            <div class="row">
              <div class="col">
                <h6>Comments:</h6>
                <p class="h6" style="text-decoration: none;">{{i.Invoice_comments}}</p>
                
              
              </div>
              <div class="col">
                <h6>Status:</h6>
                {% if i.Invoice_status %}
              <h6 style="text-decoration: none; size: 10px; color: #28a745;">Confirmed</h6>
              {% else %}
              <h6 style="text-decoration: none; size: 10px; color: #dc3545;">Pending</h6>
              {% endif %}
              </div>
              
            </div>
            <hr class="mt-2 mb-2">
            
            <div class="row">
              <div class="col-6">
                <h6>Sub Total: Rs <span id='subtotal1' style="font-weight: bold;">{{i.Invoice_SubTotal_Amount}}</span> <input type="number" name="SubTotal" id="SubTotal" hidden></h6>
                {% if i.Invoice_gst_number != ' ' %}
                <h6>GST Number: {{i.Invoice_gst_number}}</h6>
                {% else %}
                <h6>GST Number: N/A</h6>
                {% endif %}
    
                
                
              </div>
              <div class="col-6">
                <div class="row">
                  {% for tg in i.tagstotal_set.all %}
                  
                    <div class="col-5">
                      <h6><b>{{tg.Defined_Tags}}:</b>  {{tg.Tag_total}}</h6>
                  </div>
                  {% endfor %}
                </div>
              </div>
              
             
            </div>
            <h6 class="border p-3" style="width: auto;text-align: center;">Total(with GST): Rs <span id='total1' style="font-weight: bold;">{{i.Invoice_Total_Amount}}</span> <input type="number" name="FinalTotal" id="FinalTotal" hidden></h6>
            <hr class="mt-3 mb-2">

            <div class="row">
              {% if request.user.salesuser.Sales_User_include_bnkdetails %}
              <div class="col-12">
                <div class="row">
                  <div class="h6 text-sm">
                    Our Bank Details
                  </div>
                  <div class="col"> 
                    <div class="h6 text-sm">
                      Bank Name: {{request.user.salesuser.Sales_User_bnk_name}}
                    </div>
                    
                  </div>
                  <div class="col">
                    <div class="h6 text-sm">
                      IFS/NEFT Code: {{request.user.salesuser.Sales_User_bnk_code}}
                     </div>
                  </div>
                  <div class="col">
                    <div class="h6 text-sm">
                      A/c No: {{request.user.salesuser.Sales_User_bnk_accnt_no}}
                    </div>
                  </div>
                </div>
               
              </div>
              {% else %}
              {% endif%}
            </div>
            
            <hr class="mt-3 mb-2">
            <p class="text-xxs printtoc"><b>Terms and Conditions: </b> {{request.user.salesuser.Sales_User_Terms_condition}}</p>
         
            
            </div>

            </form>





            <div class="modal-footer noprint">
              <div class="row">
                <div class="col">
                  
                  <button type="button" class="btn btn-primary" data-bs-dismiss="modal" onclick="editInvoice('{{i.Invoice_ID}}');">Edit</button>
                </div>
                <div class="col">
                  <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
              </div>
              
              
            </div>
          </div>
        </div>
      </div>

     


      <!-- Delete Confirmation Modal -->
      <div class="modal fade" id="d{{i.Invoice_ID}}" tabindex="-1" role="dialog" aria-labelledby="exampleModalLongTitle" aria-hidden="true">
        <div class="modal-dialog modal-xl" role="document">
          <div class="modal-content" style="overflow: scroll;">
            

            <div class="modal-header">
              <h6 class="modal-title" id="exampleModalLongTitle">Please Confirm your choice!</h6>
              <div class="col-1 text-right noprint">
                <button type="button" class="btn-close " data-bs-dismiss="modal" aria-label="Close">
                  <span aria-hidden="true" style="color: black;">&times;</span>
                </button>
              </div>
            </div>

            <div class="modal-body">
              <h6>You are deleting the following invoice:</h6>
              <hr>



              <h6>Title: {{i.Invoice_Title}} - {{i.Invoice_member_ID}}</h6>
              <h6>Invoice ID: {{i.Invoice_ID}}</h6>
              <h6>Member ID: {{i.Invoice_member_ID}}</h6>
              <!-- <h6>Invoice Created by: <span style="text-transform: capitalize;">{{i.Invoice_User.Sales_User.username}}</span> - {{i.Invoice_User.SalesUser_ID}}</h6> -->
              <h6>Contact Information :  {{i.Invoice_ContactInfo}}</h6>
              <hr class="mt-0 mb-2">
              <h6>Time Stamp :  {{i.Invoice_Date}}</h6>
          
              <div class="table-responsive">
                <table class="table align-items-center table-flush" id="tedit{{i.Invoice_ID}}">
                  <thead>
                      <tr>
                          <th class="text-center text-uppercase text-secondary text-xxs font-weight-bolder opacity-7 col-0 border" style="background-color: #f6f9fc;">#</th>
                          <th class="col-3 border text-uppercase text-secondary text-xxs font-weight-bolder opacity-7" style="background-color: #f6f9fc;">ID - Name</th>
                          <th class="text-right col-3 border text-uppercase text-secondary text-xxs font-weight-bolder opacity-7" style="background-color: #f6f9fc;">Quantity</th>
                          <th class="text-right col-3 border text-uppercase text-secondary text-xxs font-weight-bolder opacity-7" style="background-color: #f6f9fc;">Price (MRP)</th>
                          <th class="text-right col-3 border Unhideprint text-uppercase text-secondary text-xxs font-weight-bolder opacity-7" style="background-color: #f6f9fc;" hidden>Tax Rate:</th>
                          <th class="text-right col-3 mr-3 border text-uppercase text-secondary text-xxs font-weight-bolder opacity-7" style="background-color: #f6f9fc;">Amount</th>
                          
                          
                      </tr>
                  </thead>
                  <tbody id="tablebody{{i.Invoice_ID}}">
                    {% for x in i.invoiceitem_set.all %}
                      <tr>
                          <td class="text-center h6 mb-0 text-xs">{{forloop.counter}}</td>
                          <td >
                            <input type="text" class='form-control inp{{i.Invoice_ID}} ItemName1' name="ItemName1{{i.Invoice_ID}}{{x.Item_ID}}" id="ItemName1{{i.Invoice_ID}}{{x.Item_ID}}" value="{{x.Item_ID}} : {{x.Item_name}}" hidden><span id="field" class="h6 mb-0 text-xs">{{x.Item_ID}} : {{x.Item_name}}</span>
                            <div class="row px-2 h6 mb-0 text-xs">
                              {% for p in list_product %}
                                {% if p.Product_ID == x.Item_ID %}
                                  {% for tg in p.producttags_set.all %}
                                  <span>
                                  <div class="col-4">
                                    <h6 style="color: #7a857d;" class=" mb-0 text-xs">{{tg.Defined_Tags.Tag_Title}}: <b id="tagval{{t.Tag_Title}}0">{{tg.Tag_value}}</b></h6>  
          
                                  </div>
                                </span>
                                  {% endfor %}
                                {% else %}
                                {% endif %}
                              {% endfor %}
                            </div>
                          </td>
  
                          <td class="text-right "><input type="text" class='form-control inp{{i.Invoice_ID}} Quantity1' name="Quantity1{{i.Invoice_ID}}{{x.Item_ID}}" id="Quantity1{{i.Invoice_ID}}{{x.Item_ID}}" value="{{x.Item_Quantity}}" hidden><span id="field" class="h6 mb-0 text-xs">{{x.Item_Quantity}}</span></td>
                          <td class="text-right "><input type='number' class='form-control priceperQuantityg1{{i.Invoice_ID}}' id="priceperQuantityg1{{i.Invoice_ID}}{{x.Item_ID}}" name="priceperQuantityg1{{i.Invoice_ID}}{{x.Item_ID}}" placeholder='Price with GST' hidden><input type="text" class='form-control inp{{i.Invoice_ID}} priceperQuantity1' name="priceperQuantity1{{i.Invoice_ID}}{{x.Item_ID}}" id="priceperQuantity1{{i.Invoice_ID}}{{x.Item_ID}}" value="{{x.Item_price}}" hidden><span id="field" class="h6 mb-0 text-xs">{{x.Item_price}}</span>
                            <div class="row px-2">
                              {% for p in list_product %}
                                {% if p.Product_ID == x.Item_ID %}
                                    {% for tg in p.producttags_set.all %}
                                    <div class="col">
                                      
                                      <h6 style="color: #28a745;" class="mb-0 text-xs">{{tg.Defined_Tags.Tag_Title}}: <b id="tagtotd{{tg.Tag_value}}{{i.Invoice_ID}}{{forloop.counter}}{{p.Product_ID}}"></b></h6>  
                                    
                                      <input type='number' class='form-control tagvalinp{{t.Defined_Tags.Tag_Title}} mt-3' id="tagvalinp{{t.Defined_Tags.Tag_Title}}" name="tagvalinp{{t.Defined_Tags.Tag_Title}}" placeholder='Price' step="0.01" value="0" hidden>
                                    </div>
  
                                    <script>
                                      document.getElementById('tagtotd{{tg.Tag_value}}{{i.Invoice_ID}}{{forloop.counter}}{{p.Product_ID}}').innerText = (parseFloat('{{tg.Tag_value}}')*parseFloat('{{x.Item_Quantity}}')).toFixed(2);
                                    </script>
                                    {% endfor %}
                                {% else %}
                                {% endif %}
                              {% endfor %}
                            </div>
                          </td>
                          
                          <td class="text-right Unhideprint" hidden><span id="field" class="Unhideprint h6 mb-0 text-xs">{{x.Item_gst}}</span></td>
                          <td class="text-right mr-3">
                          {% if x.Member %}
                            <input type='number' class='form-control price1g' id='priceg{{i.Invoice_ID}}' name="priceg{{i.Invoice_ID}}" placeholder='Total Price With GST' hidden><input type="text" class='form-control inp{{i.Invoice_ID}} price2' name="price1{{i.Invoice_ID}}" id="price1{{i.Invoice_ID}}" value="{%widthratio x.Item_price 1 x.Item_Quantity%}" hidden><span id="field1" class="h6 mb-0 text-xs"> Rs {%widthratio x.Item_price 1 x.Item_Quantity%}</span>
                          {% else %}
                          <input type='number' class='form-control price1g' id='priceg{{i.Invoice_ID}}' name="priceg{{i.Invoice_ID}}" placeholder='Total Price With GST' hidden><input type="text" class='form-control inp{{i.Invoice_ID}} price2' name="price1{{i.Invoice_ID}}" id="price1{{i.Invoice_ID}}" value="{%widthratio x.Item_price 1 x.Item_Quantity%}" hidden><span id="field1" class="h6 mb-0 text-xs">Rs {%widthratio x.Item_price 1 x.Item_Quantity%}</span>
                          {% endif %}
  
                          
                          </td>
                         
                      </tr>
                    
                    {% endfor %}
  
                    
                     
                  </tbody>
                  
              </table>
                </div>
            <hr class="mt-2 mb-2">
            
            <h6>Sub Total: Rs {{i.Invoice_SubTotal_Amount}}</h6>
            <h6>GST Number: {{i.Invoice_gst_number}}</h6>

            <h6 class="border p-3" style="width: auto;text-align: center;">Total: Rs {{i.Invoice_Total_Amount}}</h6>
            <hr class="mt-3 mb-2">
              
                
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
              <form action="/delete_invoice/" method="post">
                {% csrf_token %}
                <input type="text" name="ID" id="ID" value="{{i.Invoice_ID}}" hidden>  
              <button class="btn btn-primary" type="submit">Delete</button>
            </form>
            </div>
          
          </div>
        </div>
      </div>


      
      {% endfor %}
      {% else %}
      {% endif %}
        <!-- section end -->
      </div>

      <br>

      <div id="test">

      </div>
      
   


    
  

    {% include "includes/footer.html" %}
  </div>


  
  </div>
  
</main>

<style>
  .autocomplete {
  position: relative;
  overflow:hidden;
  
}
  .autocomplete-items {
  position: relative;
  border: 1px solid #d4d4d4;
  border-bottom: none;
  border-top: none;
  z-index: 99;
  
  
  left: 0;
  right: 0;
  overflow:visible;
  height: 0px;
}

.autocomplete-items div {
  padding: 10px;
  cursor: pointer;
  background-color: #fff; 
  border-bottom: 1px solid #d4d4d4; 
  
}


.autocomplete-items div:hover {
  background-color: #e9e9e9; 
  
}


.autocomplete-active {
  background-color: DodgerBlue !important; 
  color: #ffffff; 
 
}

@media screen {
    #printSection {
        display: none;
    }
}
@media print {
    body * {
        visibility:hidden;
        
    }
    #printSection, #printSection * {
        visibility:visible;
    }
    #printSection {
        position:absolute;
        left:0;
        top:0;
        width: 100%;
        height: 95%;
        margin-top: 50px;
        page-break-after: auto;
        
    }
    .noprint{
       display:none;
   }

   .printimg{
    margin-top: 0px;
    margin-bottom: 0px;
   }
   .printtoc{
    font-size: 1px;
    color: #7a857d;
   }

   .printinfo{
    font-size: 10px;
   }


   .Unhideprint
    {
      visibility:visible;
    }
}

</style> 
    
  
{% endblock content %}

<!-- Specific JS goes HERE --> 
{% block javascripts %}

<script> 
var Invoice_value = ("{{ Invoices_values }}".replace(/[\])}[{(]/g, '')).split(',');
var Invoices_Numbers = ("{{ Invoices_Number }}".replace(/[\])}[{(]/g, '')).split(',');

   var ctx = document.getElementById("chart-bars").getContext("2d");

new Chart(ctx, {
  type: "bar",
  data: {
    labels: ["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Spet","Oct","Nov","Dec"],
    datasets: [{
      label: "Sales",
      tension: 0.4,
      borderWidth: 0,
      pointRadius: 0,
      backgroundColor: "#fff",
      data: Invoices_Numbers,
      maxBarThickness: 6
    }, ],
  },
  options: {
    responsive: true,
    maintainAspectRatio: false,
    legend: {
      display: false,
    },
    tooltips: {
      enabled: true,
      mode: "index",
      intersect: false,
    },
    scales: {
      yAxes: [{
        gridLines: {
          borderDash: [2],
          borderDashOffset: [2],
          color: '#606060',
          zeroLineColor: '#606060',
          zeroLineWidth: 1,
          zeroLineBorderDash: [2],
          drawBorder: false,
        },
        ticks: {
          suggestedMin: 0,
          suggestedMax: 5,
          beginAtZero: true,
          padding: 5,
          fontSize: 14,
          lineHeight: 2,
          fontColor: "#fff",
          fontStyle: 'normal',
          fontFamily: "Open Sans",
        },
      }, ],
      xAxes: [{
        gridLines: {
          display: false,
          
         
        },
        ticks: {
          padding: 10,
          fontSize: 11,
          fontColor: '#adb5bd',
          lineHeight: 1,
          fontStyle: 'normal',
          fontFamily: "Open Sans",
        },
      }, ],
    },
  },
});


</script>

    <script>
      
      
      var input = document.getElementById('Quantity0');
      var price = document.getElementById('priceperQuantity0');
      var mid = document.getElementById('MemberID1');
      
      
      input.addEventListener('input', function () {
        updateValue('price0', input,price,'ItemName0','priceg0','priceperQuantityg0');
      });
      price.addEventListener('input', function () {
        updateValue('price0', input,price,'ItemName0','priceg0','priceperQuantityg0');
      });

      // mid.addEventListener('input', function () {
      //   updateAllVal();
      // });

      document.getElementById('Quantity0').addEventListener('keydown', function(event) {tabnadd(event);});



    
    var Item_ID1 = {{Item_ID_main|safe}};
    var MemberID1 = {{MemberID|safe}};
    var Invoice_names1 = {{Invoice_names|safe}};

    

  

    autocomplete(document.getElementById("InvoiceName"), Invoice_names1);
    autocomplete(document.getElementById("MemberID1"), MemberID1);

    function myCreateFunction() {
      var count = document.getElementById('tbody').getElementsByTagName('tr').length;
      document.getElementById('numberofitems').setAttribute('value',parseInt(count+1));

      var table = document.getElementById("myTable");
      var row = table.insertRow(-1);
      var cell1 = row.insertCell(0);
      var cell2 = row.insertCell(1);
      var cell3 = row.insertCell(2);
      var cell4 = row.insertCell(3);
      var cell5 = row.insertCell(4);
      
      var IDNAME = "ItemName"+count;
   

      var Quantity1 = "Quantity"+count;
      var priceperQuantity1 = "priceperQuantity"+count;
      var priceperQuantityg1 = "priceperQuantityg"+count;
      var price1 = "price"+count;
      var priceg1 = "priceg"+count;

      var input1 = "input"+count;
      var pricee = "price"+count;

      var stock = 'stock'+count;

      
     
      cell1.innerHTML = document.getElementById('tbody').getElementsByTagName('tr').length;
      cell2.innerHTML = "<input type='text' class='form-control' id='"+IDNAME+"' name='"+IDNAME+"' placeholder='Item ID' autocomplete='off'>";
      
      cell3.innerHTML = "<input type='number' min='1' class='form-control mt-3'id='"+Quantity1+"' name='"+Quantity1+"' value='0' placeholder='Quantity'><div class='row px-2'><div class='col'><h6 style='color: rgb(182, 182, 182);;' class=' mb-0 text-xs'>Available Stock: <span id='"+stock+"'>0</span></h6> </div></div>";
      cell4.innerHTML = "<input type='number' min='0' step='0.01' class='form-control border' id='"+priceperQuantityg1+"' name='"+priceperQuantityg1+"' placeholder='Price with GST' hidden><input type='number' class='form-control mt-3' id='"+priceperQuantity1+"' name='"+priceperQuantity1+"' placeholder='Price'>" +  "<div class='row px-2'>{% for t in request.user.salesuser.SalesUser_Inventory.definedtags_set.all %}<div class='col'><h6 style='color: #28a745;'' class='mb-0 text-xs'>{{t.Tag_Title}}: <span id='tagval{{t.Tag_Title}}"+count+"'>0</span></h6><input type='number' class='form-control tagvalinp{{t.Tag_Title}} mt-3' id='tagvalinp{{t.Tag_Title}}"+count+"' name='tagvalinp{{t.Tag_Title}}"+count+" step='0.01' value='0' hidden></div>{% endfor %}</div>";
      cell5.innerHTML = "<input type='number' min='0' step='0.01' class='form-control price1g' id='"+priceg1+"' name='"+priceg1+"' placeholder='Total Price with GST' hidden><input type='number' class='form-control price1' id='"+price1+"' name='"+price1+"' placeholder='Total Price'>" +"<div class='row px-2'>{% for t in request.user.salesuser.SalesUser_Inventory.definedtags_set.all %}<div class='col  mb-0 text-xs'><input type='number' class='form-control tagvalinptot{{t.Tag_Title}} mt-3' id='tagvalinptot{{t.Tag_Title}}"+count+"' name='tagvalinptot{{t.Tag_Title}}"+count+" step='0.01' value='0' hidden></div>{% endfor %}</div>" ;
      
      
      var elem = document.getElementById(IDNAME);
      elem.focus();

      var text1 = "var "+input1+" = document.getElementById('"+Quantity1+"');\n";
      
      var text2 = "var "+pricee+" = document.getElementById('"+priceperQuantity1+"');\n";
      
      var text3 = "document.getElementById('"+Quantity1+"').addEventListener('input', function(){updateValue('"+price1+"', "+input1+","+pricee+",'"+IDNAME+"','"+priceg1+"','"+priceperQuantityg1+"');});\n";
      var text4 = "document.getElementById('"+priceperQuantity1+"').addEventListener('input', function(){updateValue('"+price1+"', "+input1+","+pricee+",'"+IDNAME+"','"+priceg1+"','"+priceperQuantityg1+"');}); \n";
      var text5 = "document.getElementById('"+Quantity1+"').addEventListener('keydown', function(event) {tabnadd(event,"+IDNAME+");});\n";
      
      var script = document.createElement("script");
      script.innerHTML = text1 + text2+text3+text4+text5;
      document.body.appendChild(script);


      autocomplete(document.getElementById(IDNAME), Item_ID1, priceperQuantity1,priceperQuantityg1,price1,input1,Quantity1,stock);

  
    
    }

    function myDeleteFunction() {
      
      if(document.getElementById('tbody').getElementsByTagName('tr').length >1){
        document.getElementById("myTable").deleteRow(-1);
        var count = document.getElementById('tbody').getElementsByTagName('tr').length;
      document.getElementById('numberofitems').setAttribute('value',parseInt(count));
      }
      
      invoicesubTotal();
    }

    function tabnadd(event,focuselem){
     
          if (event.keyCode == 9) {
          event.preventDefault();
          myCreateFunction();
         
        }
    }



  
   

  function autocomplete(inp, arr, qpricee,priceperQuantity,aa,bb,cc,dd) {
    
    
    /*the autocomplete function takes two arguments,
    the text field element and an array of possible autocompleted values:*/

    var currentFocus;
    /*execute a function when someone writes in the text field:*/
    inp.addEventListener("input", function(e) {
        var a, b, i, val = this.value;
        /*close any already open lists of autocompleted values*/
        closeAllLists();
        if (!val) { return false;}
        currentFocus = -1;
        /*create a DIV element that will contain the items (values):*/
        a = document.createElement("DIV");
        a.setAttribute("id", this.id + "autocomplete-list");
        a.setAttribute("class", "autocomplete-items");
        /*append the DIV element as a child of the autocomplete container:*/
        this.parentNode.appendChild(a);
        /*for each item in the array...*/
        for (i = 0; i < arr.length; i++) {
          /*check if the item starts with the same letters as the text field value:*/
          if (arr[i].substr(0, val.length).toUpperCase() == val.toUpperCase()) {
            /*create a DIV element for each matching element:*/
            b = document.createElement("DIV");
            /*make the matching letters bold:*/
            b.innerHTML = "<strong>" + arr[i].substr(0, val.length) + "</strong>";
            b.innerHTML += arr[i].substr(val.length);
            /*insert a input field that will hold the current array item's value:*/
            b.innerHTML += "<input type='hidden' value='" + arr[i] + "'>";
            /*execute a function when someone clicks on the item value (DIV element):*/
            b.addEventListener("click", function(e) {
                /*insert the value for the autocomplete text field:*/
                // inp.value = this.getElementsByTagName("input")[0].value;
                inp.setAttribute('value',this.getElementsByTagName("input")[0].value);
                inp.value = this.getElementsByTagName("input")[0].value;
                
                
                priceFinder(inp.value, qpricee, priceperQuantity,dd,cc);
                
                
                /*close the list of autocompleted values,
                (or any other open lists of autocompleted values:*/
                closeAllLists();
               
            });
            a.appendChild(b);
          }
        }
        
    });
    /*execute a function presses a key on the keyboard:*/
    inp.addEventListener("keydown", function(e) {
        var x = document.getElementById(this.id + "autocomplete-list");
        if (x) x = x.getElementsByTagName("div");
        if (e.keyCode == 40) {
          /*If the arrow DOWN key is pressed,
          increase the currentFocus variable:*/
          currentFocus++;
          /*and and make the current item more visible:*/
          addActive(x);
        } else if (e.keyCode == 38) { //up
          /*If the arrow UP key is pressed,
          decrease the currentFocus variable:*/
          currentFocus--;
          /*and and make the current item more visible:*/
          addActive(x);
        } else if (e.keyCode == 13) {
          /*If the ENTER key is pressed, prevent the form from being submitted,*/
          e.preventDefault();
          if (currentFocus > -1) {
            /*and simulate a click on the "active" item:*/
            if (x) x[currentFocus].click();
          }
        }
    });
    function addActive(x) {
      /*a function to classify an item as "active":*/
      if (!x) return false;
      /*start by removing the "active" class on all items:*/
      removeActive(x);
      if (currentFocus >= x.length) currentFocus = 0;
      if (currentFocus < 0) currentFocus = (x.length - 1);
      /*add class "autocomplete-active":*/
      x[currentFocus].classList.add("autocomplete-active");
    }
    function removeActive(x) {
      /*a function to remove the "active" class from all autocomplete items:*/
      for (var i = 0; i < x.length; i++) {
        x[i].classList.remove("autocomplete-active");
      }
    }
    function closeAllLists(elmnt) {
      /*close all autocomplete lists in the document,
      except the one passed as an argument:*/
      var x = document.getElementsByClassName("autocomplete-items");
      for (var i = 0; i < x.length; i++) {
        if (elmnt != x[i] && elmnt != inp) {
          x[i].parentNode.removeChild(x[i]);
        }
      }
    }
    /*execute a function when someone clicks in the document:*/
    document.addEventListener("click", function (e) {
        closeAllLists(e.target);
    });
  }
  
  /*An array containing all the country names in the world:*/
  var countries = ["Afghanistan","Albania","Algeria","Andorra","Angola","Anguilla","Antigua & Barbuda","Argentina","Armenia","Aruba","Australia","Austria","Azerbaijan","Bahamas","Bahrain","Bangladesh","Barbados","Belarus","Belgium","Belize","Benin","Bermuda","Bhutan","Bolivia","Bosnia & Herzegovina","Botswana","Brazil","British Virgin Islands","Brunei","Bulgaria","Burkina Faso","Burundi","Cambodia","Cameroon","Canada","Cape Verde","Cayman Islands","Central Arfrican Republic","Chad","Chile","China","Colombia","Congo","Cook Islands","Costa Rica","Cote D Ivoire","Croatia","Cuba","Curacao","Cyprus","Czech Republic","Denmark","Djibouti","Dominica","Dominican Republic","Ecuador","Egypt","El Salvador","Equatorial Guinea","Eritrea","Estonia","Ethiopia","Falkland Islands","Faroe Islands","Fiji","Finland","France","French Polynesia","French West Indies","Gabon","Gambia","Georgia","Germany","Ghana","Gibraltar","Greece","Greenland","Grenada","Guam","Guatemala","Guernsey","Guinea","Guinea Bissau","Guyana","Haiti","Honduras","Hong Kong","Hungary","Iceland","India","Indonesia","Iran","Iraq","Ireland","Isle of Man","Israel","Italy","Jamaica","Japan","Jersey","Jordan","Kazakhstan","Kenya","Kiribati","Kosovo","Kuwait","Kyrgyzstan","Laos","Latvia","Lebanon","Lesotho","Liberia","Libya","Liechtenstein","Lithuania","Luxembourg","Macau","Macedonia","Madagascar","Malawi","Malaysia","Maldives","Mali","Malta","Marshall Islands","Mauritania","Mauritius","Mexico","Micronesia","Moldova","Monaco","Mongolia","Montenegro","Montserrat","Morocco","Mozambique","Myanmar","Namibia","Nauro","Nepal","Netherlands","Netherlands Antilles","New Caledonia","New Zealand","Nicaragua","Niger","Nigeria","North Korea","Norway","Oman","Pakistan","Palau","Palestine","Panama","Papua New Guinea","Paraguay","Peru","Philippines","Poland","Portugal","Puerto Rico","Qatar","Reunion","Romania","Russia","Rwanda","Saint Pierre & Miquelon","Samoa","San Marino","Sao Tome and Principe","Saudi Arabia","Senegal","Serbia","Seychelles","Sierra Leone","Singapore","Slovakia","Slovenia","Solomon Islands","Somalia","South Africa","South Korea","South Sudan","Spain","Sri Lanka","St Kitts & Nevis","St Lucia","St Vincent","Sudan","Suriname","Swaziland","Sweden","Switzerland","Syria","Taiwan","Tajikistan","Tanzania","Thailand","Timor L'Este","Togo","Tonga","Trinidad & Tobago","Tunisia","Turkey","Turkmenistan","Turks & Caicos","Tuvalu","Uganda","Ukraine","United Arab Emirates","United Kingdom","United States of America","Uruguay","Uzbekistan","Vanuatu","Vatican City","Venezuela","Vietnam","Virgin Islands (US)","Yemen","Zambia","Zimbabwe"];
  
  /*initiate the autocomplete function on the "myInput" element, and pass along the countries array as possible autocomplete values:*/
  autocomplete(document.getElementById("ItemName0"), Item_ID1,'priceperQuantity0','priceperQuantityg0','price0','Quantity0','price0','stock0');
  



  </script>


<script>
  

// event listner when you type into the input fields.
function updateValue(a, b,c,d,e,f) {
  

  if (a != null){
    count = a.split(/([0-9]+)/);
  
  "{% for t in request.user.salesuser.SalesUser_Inventory.definedtags_set.all %}"
    document.getElementById("tagvalinptot{{t.Tag_Title}}"+count[1]).setAttribute('value',(b.value * document.getElementById('tagvalinp{{t.Tag_Title}}'+count[1]).value));

  "{% endfor %}"
  
  }
  
  document.getElementById(a).setAttribute('value',(b.value * c.value));
 if(f != null){
  document.getElementById(e).setAttribute('value',(b.value * document.getElementById(f).value));
 }
  
  
  invoicesubTotal();
  invoicesubTotal1();



  
}


// function to make invoice total
function invoicesubTotal(){

  var x = document.getElementsByClassName("price1");
  var subtotal = document.getElementById('subtotal');
  var sum = 0;
  for(i = 0; i < x.length;i++){
   
    if (parseInt(x[i].value) > 0){
      sum = parseFloat(sum) + parseFloat(x[i].value);
    }else{
      sum = parseFloat(sum);
    }
    subtotal.innerHTML = parseFloat(sum).toFixed(2);
    document.getElementById('SubTotal').setAttribute('value',sum)
    
  }
  

  tags = [];
  
  "{% for t in request.user.salesuser.SalesUser_Inventory.definedtags_set.all %}"
    tags.push("{{t.Tag_Title}}");
    "{% endfor %}"

    for(x = 0;x<=tags.length;x++){
      var sum = 0;
   
    
    for(i = 0; i < document.getElementsByClassName("tagvalinptot"+tags[x]).length;i++){
      
      if (parseFloat(document.getElementsByClassName("tagvalinptot"+tags[x])[i].value) > 0){
        sum = sum + parseFloat(document.getElementsByClassName("tagvalinptot"+tags[x])[i].value);
      }else{
        sum = sum;
      }
      document.getElementById('tagsp'+tags[x]).innerHTML = sum.toFixed(2);
      document.getElementById('tag'+tags[x]).setAttribute('value',sum.toFixed(2));
      
    }
  }
  
  invoiceTotal();
  
}



function invoicesubTotal1(){
  
  
  var x = document.getElementsByClassName("price2");
  var subtotal = document.getElementById('subtotal1');
  var sum = 0;
  for(i = 0; i < x.length;i++){
   
    if (parseInt(x[i].value) > 0){
      sum = sum + parseInt(x[i].value);
    }else{
      sum = sum;
    }
    subtotal.innerHTML = sum;
    document.getElementById('SubTotal1').setAttribute('value',sum)
    
  }
  invoiceTotal1();
  
  
  
}

// function to make final total inclusing gst
function invoiceTotal(){
  var x = document.getElementsByClassName("price1g");
  var subtotal = document.getElementById('total');
  var sum = 0;
  for(i = 0; i < x.length;i++){

     
   
    if (parseInt(x[i].value) > 0){
      sum = parseFloat(sum) + parseFloat(x[i].value);
    }else{
      sum = parseFloat(sum);
    }
    subtotal.innerHTML = parseFloat(sum).toFixed(2);
    document.getElementById('FinalTotal').setAttribute('value',sum);
   
  }

  
}


function invoiceTotal1(sum){
  var total = document.getElementById('total1');
  var gst = 0; //Change this
  if ( gst != 0){
    var gst_value = (gst/100)*sum;
  var sum1 = parseInt(sum) + parseInt(gst_value);
  }else{
    var sum1 = parseInt(sum);
  }
  total.innerHTML = sum1;
  document.getElementById('FinalTotal1').setAttribute('value',sum1);
}

function updateAllVal(){

  var count = document.getElementById('tbody').getElementsByTagName('tr').length;
  // autocomplete(document.getElementById("ItemName0"), Item_ID1,'priceperQuantity0','priceperQuantityg0','price0','Quantity0','price0','stock0');
  for(i=0;i<count;i++){
      priceFinder(document.getElementById('ItemName'+i).value, ('priceperQuantity'+i), ('priceperQuantityg'+i),('stock'+i),('price'+i));

      var input = document.getElementById('Quantity'+i);
      var price = document.getElementById('priceperQuantity'+i);
      updateValue(('price'+i), input,price,('ItemName'+i),('priceg'+i),('priceperQuantityg'+i));
      
  }

}

// price finder 
function priceFinder(inp1,inp2,inp3,inp4,inp5){


  

  var inp = document.getElementById(inp2);
  var inpg = document.getElementById(inp3);
  var stock = document.getElementById(inp4);
  var Quantity = document.getElementById(inp5);

  var count = document.getElementById('tbody').getElementsByTagName('tr').length;
  
 
  var dict = {{Products|safe}};
  
  var item = inp1.split(" : ");
  for(var key in dict) {
   
    k = key.split(' : ');
    
    // document.getElementById('test').append("---"+dict[key]);
   
    // document.getElementById('test').append(key+"--"+inp1 +"+++"+(String(inp1).localeCompare(String(key)))+" <br> ")
   if ((String(item[0]).localeCompare(String(k[0])) == 0)){
    

    var status = document.getElementById('MemberID1').value.length == 0;

  
    
    if(!status){
      inp.setAttribute('value',dict[key][1]);
      inpg.setAttribute('value',(dict[key][1]*dict[key][2]));

 
    }else{
      inp.setAttribute('value',dict[key][0]);
      inpg.setAttribute('value',(dict[key][0]*dict[key][2]));
     
    }
    
    stock.innerHTML = dict[key][4];
    
    if (Quantity.value > 0){
      Quantity.setAttribute('max',dict[key][4]);
    }
    
    
    
    
    for(i = 0;i<dict[key][3].length;i++){
      
      var tag =  dict[key][3][i].split('-');
      
      var tagname = tag[0];
      var tagval = tag[1];
     

      document.getElementById('tagval'+tagname+(count-1)).innerHTML = tagval;
      
      document.getElementById('tagvalinp'+tagname+(count-1)).setAttribute('value',tagval);
      
      
    }

    
    

    
   }


} 

  
}


</script>



<script>

'{% if Invoices != 0 %}'
'{% for i in Invoices %}'
document.getElementById("Print{{i.Invoice_ID}}").onclick = function () {
    printElement(document.getElementById("printThis{{i.Invoice_ID}}"));
};
'{% endfor %}'
'{% endif %}'
  

function printElement(elem) {
    var domClone = elem.cloneNode(true);

    var $printSection = document.getElementById("printSection");

    if (!$printSection) {
        var $printSection = document.createElement("div");
        $printSection.id = "printSection";
        document.body.appendChild($printSection);
    }

    $printSection.innerHTML = "";
    $printSection.appendChild(domClone);
    window.print();
}
</script>

<script>
  function editInvoice(a){
    
    
    

      
    "{% if Invoices != 0 %}"
      "{% for i in Invoices %}"
      //svar count = document.getElementById('tbody').getElementsByTagName('tr').length;
      document.getElementById('numberofitems').setAttribute('value',parseInt(document.getElementById('tbody').getElementsByTagName('tr').length+1));

        if(String(a) == "{{i.Invoice_ID}}"){
          document.getElementById('InvoiceName').setAttribute('value',"{{i.Invoice_Title}}");
          if('{{i.Invoice_member_ID}}'.length != 0){
            document.getElementById('MemberID1').setAttribute('value',"{{i.Invoice_member_ID}}");
          }

         
          
          
          
          document.getElementById('cinfo').setAttribute('value',"{{i.Invoice_ContactInfo}}");
          //document.getElementById('subtotal').innerHTML = ("{{i.Invoice_SubTotal_Amount}}");
          //document.getElementById('SubTotal').setAttribute('value',"{{i.Invoice_SubTotal_Amount}}");
          //document.getElementById('total').innerHTML = ("{{i.Invoice_Total_Amount}}");
          //document.getElementById('FinalTotal').setAttribute('value',"{{i.Invoice_Total_Amount}}");
          document.getElementById('gstnumber').innerHTML = ("{{i.Invoice_gst_number}}");
          document.getElementById('INID').hidden = false;
          document.getElementById('hed2').hidden = false;
          document.getElementById('hed1').hidden = true;
          document.getElementById('ID').innerHTML = ("{{i.Invoice_ID}}");
          document.getElementById('date').innerHTML = ("{{i.Invoice_Date}}");
          document.getElementById('invoiceID').setAttribute('value',"{{i.Invoice_ID}}");
          document.getElementById('comments').innerText = "{{i.Invoice_comments}}";
          document.getElementById('savebutton').hidden = true;
          document.getElementById('savebutton2').hidden = false;

          "{% if i.Invoice_status %}"
            document.getElementById('customCheck2').checked = true;
          "{% else %}"
          document.getElementById('customCheck2').checked = false;
          "{% endif %}"

          
          
         


          "{% for x in i.invoiceitem_set.all %}"
          
          
            if(parseInt(document.getElementById('tbody').getElementsByTagName('tr').length) < parseInt("{{ forloop.counter }}")){
              
              
              myCreateFunction();
              
            }else if((document.getElementById('tbody').getElementsByTagName('tr').length) >= parseInt("{{ i.invoiceitem_set.all.count }}")){
        
              while (parseInt(document.getElementById('tbody').getElementsByTagName('tr').length) > parseInt("{{ forloop.counter }}")) {
                  // code block to be executed
                  myDeleteFunction();
                }
            }else{
              
            }
            
            
            document.getElementById('ItemName{{ forloop.counter0 }}').setAttribute('value',"{{x.Item_ID}} : {{x.Item_name}}");
            
            document.getElementById('Quantity{{ forloop.counter0 }}').setAttribute('value',"{{x.Item_Quantity}}");
            //document.getElementById('priceperQuantity{{ forloop.counter0 }}').setAttribute('value',"{{x.Item_price}}");
            document.getElementById('priceperQuantity{{ forloop.counter0 }}').setAttribute('value',"{{x.Item_price}}");

            document.getElementById('priceperQuantityg{{ forloop.counter0 }}').setAttribute('value',parseFloat("{{x.Item_price}}")+parseFloat("{{x.Item_price}}")*(parseFloat('{{x.Item_gst}}')/100));
            
            document.getElementById('price{{ forloop.counter0 }}').setAttribute('value',"{% widthratio x.Item_price 1 x.Item_Quantity %}");
            document.getElementById('priceg{{ forloop.counter0 }}').setAttribute('value',parseInt('{{x.Item_Quantity}}')*document.getElementById('priceperQuantityg{{ forloop.counter0 }}').value);
            var newcount = parseInt('{{ forloop.counter0 }}');
            
            
            
            // document.getElementById("tagvalinptot{{t.Tag_Title}}"+newcount).setAttribute('value',(parseInt("{{x.Item_Quantity}}") * (document.getElementById('tagvalinp{{t.Tag_Title}}'+newcount).value)));
                  '{% for p in list_product %}'
                  '{% if p.Product_ID == x.Item_ID %}'

                  '{% for tg in p.producttags_set.all %}'
                  document.getElementById("tagvalinp{{tg.Defined_Tags.Tag_Title}}"+newcount).setAttribute('value',('{{tg.Tag_value}}'));
                  document.getElementById("tagval{{tg.Defined_Tags.Tag_Title}}"+newcount).innerHTML = (('{{tg.Tag_value}}'));
                  '{% endfor %}'
                  
                  '{% else %}'
                  '{% endif %}'
                  '{% endfor %}'
            


            document.getElementById('stock{{ forloop.counter0 }}').innerHTML = parseInt('{{x.Item_Quantity}}')+parseInt('{{x.Item_stock}}');
            document.getElementById('Quantity{{ forloop.counter0 }}').setAttribute('max',parseInt(document.getElementById('stock{{ forloop.counter0 }}').textContent));
            
            invoicesubTotal();
           
          "{% for y in i.tagstotal_set.all %}"
          document.getElementById('tagsp{{y.Defined_Tags}}').innerHTML = ("{{y.Tag_total}}");
          document.getElementById('tag{{y.Defined_Tags}}').setAttribute('value',("{{y.Tag_total}}"));
          document.getElementById('test').append('tagsp{{y.Defined_Tags}} - {{y.Tag_total}} ');
          "{% endfor %}"

         
            
            

            
            
          "{% endfor %}"
          document.getElementById('test').innerHTML = count;
          document.getElementById('numberofitems').setAttribute('value',parseInt(document.getElementById('tbody').getElementsByTagName('tr').length));
        }else{

        }
      "{%endfor%}"
    "{%else%}"
    "{%endif%}"

    
  }



function closeModal(a,b,c){
  $('.modal').on('hidden.bs.modal', function () {
    // do something here
    
    var x = document.getElementById(a).getElementsByTagName('span');
    var y = document.getElementsByClassName(b);
    
    document.getElementById(c).hidden = true;

    for (var i =0;i<=x.length;i++){
      x[i].hidden = false;
      if(i< y.length){
        y[i].hidden = true;
      }
      
    }
})
}
  



var today = new Date();
var dd = String(today.getDate()).padStart(2, '0');
var mm = String(today.getMonth() + 1).padStart(2, '0'); //January is 0!
var yyyy = today.getFullYear();
today = mm + '/' + dd + '/' + yyyy;

var tom = new Date();
var dd1 = String(tom.getDate()-1).padStart(2, '0');
var mm1 = String(tom.getMonth() + 1).padStart(2, '0'); //January is 0!
var yyyy1 = tom.getFullYear();
tom = mm1 + '/' + dd1 + '/' + yyyy1;

document.getElementById('startdate').setAttribute('value',tom);
document.getElementById('enddate').setAttribute('value',today);




</script>

<script>
  //invoice search filter
  function myFunction1() {
    
    var input, filter, table, tr, td, i, txtValue;
    input = document.getElementById("myInput");
    filter = input.value.toUpperCase();
    table = document.getElementById("myTablefilter");
    tr = table.getElementsByClassName("itemlist");
    
    // document.getElementById('test').append(tr[1].innerText); 
    

    for (i = 0; i < tr.length; i++) {
      
      td = tr[i];
      
      // tf = tr[i];
      
      

      
      
      
      
      if (td || tf ) {
        txtValue = td.textContent || td.innerText;
        // txtValue2 = tf.textContent || tf.innerText;
        
        
        if (txtValue.toUpperCase().indexOf(filter) > -1 ) {
          tr[i].hidden = false;
          
        } else {
          tr[i].hidden = true;
          
        }
      }  
    }

  }


  $('input').focus(function(){
    var center = $(window).height()/2;
    var top = $(this).offset().top ;
    if (top > center){
        $(window).scrollTop(top-center);
    }
});

  
  </script>






{% endblock javascripts %}
